# æ’ä»¶ç”Ÿæ€ï¼šPageHelper åˆ†é¡µæŸ¥è¯¢

!!! quote "æ‹’ç»æ— æ•ˆå†…å·"
æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ·˜å®æŠŠå‡ äº¿ä¸ªå•†å“ä¸€æ¬¡æ€§å…¨åŠ è½½å‡ºæ¥ï¼Œä½ çš„æµè§ˆå™¨ä¼šç›´æ¥å´©æºƒã€‚**åˆ†é¡µï¼ˆPaginationï¼‰** æ˜¯ Web å¼€å‘ä¸­æœ€åŸºç¡€ä¹Ÿæœ€é‡è¦çš„åŠŸèƒ½ã€‚

```
åœ¨åŸç”Ÿ JDBC æ—¶ä»£ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¡ç®— `limit offset, size`ï¼Œæå…¶ç¹çä¸”å®¹æ˜“ç®—é”™ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å¼•å…¥ **PageHelper**ï¼Œå®ƒèƒ½è®©ä½ **å½»åº•å‘Šåˆ« SQL åˆ†é¡µè¯­æ³•**ï¼Œç”¨ä¸€è¡Œä»£ç å®ç°â€œé­”æ³•â€åˆ†é¡µã€‚

```

---

## ğŸ“¦ ä¸ºä»€ä¹ˆè¦ç”¨ PageHelper?

åœ¨æ²¡æœ‰ PageHelper ä¹‹å‰ï¼Œå®ç°ä¸€ä¸ªåˆ†é¡µæŸ¥è¯¢ï¼Œä½ éœ€è¦åœ¨ Mapper XML ä¸­å†™ä¸¤é SQLï¼š

1. æŸ¥è¯¢æ•°æ®åˆ—è¡¨ï¼š`SELECT * FROM user LIMIT ?, ?`
2. æŸ¥è¯¢æ€»è®°å½•æ•°ï¼ˆä¸ºäº†ç®—æ€»é¡µæ•°ï¼‰ï¼š`SELECT COUNT(*) FROM user`

**PageHelper çš„é­”æ³•ï¼š** å®ƒåˆ©ç”¨ **MyBatis æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰** æœºåˆ¶ï¼Œåœ¨ä»£ç è¿è¡Œæ—¶è‡ªåŠ¨æ‹¦æˆªä½ çš„ SQLï¼Œå¹¶åœ¨åå°æ‚„æ‚„å¸®ä½ åšä¸¤ä»¶äº‹ï¼š

* è‡ªåŠ¨è¿½åŠ  `LIMIT` è¯­å¥ã€‚
* è‡ªåŠ¨æ‰§è¡Œ `COUNT` æŸ¥è¯¢è®¡ç®—æ€»æ•°ã€‚

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–

è¯·åœ¨é¡¹ç›®çš„ `pom.xml` ä¸­å¼•å…¥ `pagehelper-spring-boot-starter`ã€‚

> **æ³¨æ„**ï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Spring Boot 3 + JDK 17 ç¯å¢ƒï¼Œè¯·åŠ¡å¿…ä½¿ç”¨ **1.4.6** åŠä»¥ä¸Šç‰ˆæœ¬ï¼ˆæˆ–é€‚é… SB3 çš„æœ€æ–°ç‰ˆï¼‰ï¼Œé¿å…å¾ªç¯ä¾èµ–æŠ¥é”™ã€‚

```xml title="pom.xml"
<dependencies>
    <dependency>
        <groupId>com.github.pagehelper</groupId>
        <artifactId>pagehelper-spring-boot-starter</artifactId>
        <version>2.1.0</version>
    </dependency>
</dependencies>

```

!!! tip "Maven åˆ·æ–°æé†’"
ä¿®æ”¹ `pom.xml` åï¼Œåˆ«å¿˜äº†ç‚¹å‡» IDEA å³ä¸Šè§’çš„ **"Load Maven Changes"** (é‚£ä¸ªå°åˆ·æ–°å›¾æ ‡)ï¼Œæˆ–è€…æŒ‰ `Ctrl + Shift + O` é‡æ–°åŠ è½½ä¾èµ–ã€‚

---

## âš¡ ç¬¬äºŒæ­¥ï¼šService å±‚å®æˆ˜ (æ ¸å¿ƒ)

è¿™æ˜¯ PageHelper æœ€æ ¸å¿ƒçš„ç”¨æ³•ï¼Œè¯·åŠ¡å¿…èƒŒè¯µè¿™ **"ä¸‰éƒ¨æ›²"**ã€‚

=== "âœ… æ­£ç¡®å†™æ³• (ä¸‰éƒ¨æ›²)"
```java
public PageInfo<User> findUserList(int pageNum, int pageSize) {
// 1. å¼€å¯åˆ†é¡µ (é­”æ³•å¼€å§‹çš„åœ°æ–¹)
// è¿™ä¸€å¥å¿…é¡»ç´§è´´åœ¨æŸ¥è¯¢è¯­å¥ä¹‹å‰ï¼
PageHelper.startPage(pageNum, pageSize);

```
    // 2. æ‰§è¡ŒæŸ¥è¯¢
    // æ­¤æ—¶å‘å‡ºçš„ SQL ä¼šè‡ªåŠ¨åŒ…å« limit è¯­å¥
    List<User> users = userMapper.selectAll();
    
    // 3. å°è£…ç»“æœ
    // PageInfo åŒ…å«äº†æ€»é¡µæ•°ã€æ€»è®°å½•æ•°ã€å½“å‰é¡µæ•°æ®ç­‰æ‰€æœ‰å‰ç«¯éœ€è¦çš„ä¿¡æ¯
    return new PageInfo<>(users);
}
```

```

=== "âŒ å¸¸è§é”™è¯¯ (åƒä¸‡åˆ«çŠ¯)"
```java
// é”™è¯¯ç¤ºèŒƒï¼šstartPage å’ŒæŸ¥è¯¢ä¹‹é—´éš”äº†å…¶ä»–ä»£ç 
PageHelper.startPage(1, 10);

```
// å‡å¦‚è¿™é‡Œæ’å…¥äº†ä¸€æ®µé€»è¾‘ï¼Œæˆ–è€…æŠ›å‡ºäº†å¼‚å¸¸...
doSomethingElse(); 

// è¿™é‡Œçš„æŸ¥è¯¢å¯èƒ½å°±ä¸ä¼šè¢«åˆ†é¡µï¼Œæˆ–è€…æ¶ˆè€—æ‰åˆ†é¡µå‚æ•°å¯¼è‡´åç»­æŸ¥è¯¢å‡ºé”™ï¼
// å› ä¸º PageHelper ä½¿ç”¨çš„æ˜¯ ThreadLocalï¼Œå¿…é¡»ä¿è¯ "å³ç”¨å³é”€"ã€‚
List<User> users = userMapper.selectAll();
```

```

---

## ğŸ“¡ ç¬¬ä¸‰æ­¥ï¼šController å±‚å“åº”

å‰ç«¯é€šå¸¸éœ€è¦çŸ¥é“â€œä¸€å…±æœ‰å¤šå°‘é¡µâ€ã€â€œå½“å‰æ˜¯ç¬¬å‡ é¡µâ€ã€‚`PageInfo` å¯¹è±¡å®Œç¾å°è£…äº†è¿™äº›æ•°æ®ã€‚

```java title="UserController.java"
@RestController
@RequestMapping("/users")
public class UserController {

    @Autowired
    private UserService userService;

    /**
     * åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨
     * @param page å½“å‰é¡µç  (é»˜è®¤ç¬¬1é¡µ)
     * @param size æ¯é¡µæ˜¾ç¤ºæ¡æ•° (é»˜è®¤10æ¡)
     */
    @GetMapping
    public Result<PageInfo<User>> list(
            @RequestParam(defaultValue = "1") int page,
            @RequestParam(defaultValue = "10") int size) {
        
        PageInfo<User> pageInfo = userService.findUserList(page, size);
        return Result.success(pageInfo);
    }
}

```

---

## ğŸ” ç¬¬å››æ­¥ï¼šéªŒè¯ä¸ç»“æœè§£æ

å¯åŠ¨é¡¹ç›®ï¼Œä½¿ç”¨æµè§ˆå™¨æˆ– Postman è®¿é—®æ¥å£ï¼š
`http://localhost:8080/users?page=1&size=5`

ä½ å°†å¾—åˆ°å¦‚ä¸‹ç»“æ„çš„ JSON å“åº”ã€‚è¯·ä»”ç»†è§‚å¯Ÿ `PageInfo` è‡ªåŠ¨å¸®æˆ‘ä»¬è®¡ç®—äº†å“ªäº›å­—æ®µï¼š

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "pageNum": 1,        // å½“å‰é¡µç 
    "pageSize": 5,       // æ¯é¡µæ•°é‡
    "size": 5,           // å½“å‰é¡µå®é™…æ•°é‡
    "total": 108,        // âœ… æ•°æ®åº“æ€»è®°å½•æ•° (PageHelperè‡ªåŠ¨æŸ¥å‡ºæ¥çš„)
    "pages": 22,         // âœ… æ€»é¡µæ•° (PageHelperè‡ªåŠ¨ç®—å‡ºæ¥çš„)
    "list": [            // å½“å‰é¡µçš„æ•°æ®åˆ—è¡¨
      { "id": 1, "username": "admin", ... },
      { "id": 2, "username": "zhangsan", ... },
      ...
    ],
    "isFirstPage": true,
    "isLastPage": false,
    "hasPreviousPage": false,
    "hasNextPage": true
  }
}

```

---

## âš ï¸ é¿å‘æŒ‡å— (å¿…è¯»)

åœ¨é›†æˆ PageHelper æ—¶ï¼Œæ–°æ‰‹æœ€å®¹æ˜“åœ¨ä»¥ä¸‹åœ°æ–¹â€œç¿»è½¦â€ï¼š

1. **ThreadLocal æ±¡æŸ“**ï¼š
`PageHelper.startPage` åŸç†æ˜¯å°†åˆ†é¡µå‚æ•°å­˜å…¥å½“å‰çº¿ç¨‹çš„ `ThreadLocal`ã€‚å®ƒä¼šåœ¨**ç´§æ¥ç€çš„ç¬¬ä¸€æ¬¡ MyBatis æŸ¥è¯¢**åè‡ªåŠ¨æ¸…é™¤ã€‚
* **åæœ**ï¼šå¦‚æœä½ è°ƒç”¨äº† `startPage` ä½†åé¢æ²¡æœ‰æ‰§è¡Œ SQL æŸ¥è¯¢ï¼ˆæ¯”å¦‚è¢« `if` æ‹¦æˆªè¿”å›äº†ï¼‰ï¼Œè¿™ä¸ªåˆ†é¡µå‚æ•°ä¼šæ®‹ç•™åœ¨çº¿ç¨‹ä¸­ã€‚å½“è¯¥çº¿ç¨‹å¤ç”¨äºä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´è«åå…¶å¦™çš„åˆ†é¡µé”™è¯¯ã€‚
* **è§£å†³**ï¼šç¡®ä¿ `startPage` ç´§è´´æŸ¥è¯¢è¯­å¥ï¼Œæˆ–è€…æ”¾åœ¨ `try-finally` å—ä¸­æ¸…ç†ï¼ˆè™½ç„¶å®˜æ–¹è¯´è‡ªåŠ¨æ¸…ç†ï¼Œä½†ç´§è´´æŸ¥è¯¢æ˜¯æœ€å®‰å…¨çš„ä¹ æƒ¯ï¼‰ã€‚


2. **1å¯¹N æŸ¥è¯¢çš„åˆ†é¡µé—®é¢˜**ï¼š
å¦‚æœä½ åœ¨ XML ä¸­ä½¿ç”¨äº† `<collection>` è¿›è¡Œçº§è”æŸ¥è¯¢ï¼ˆæ¯”å¦‚â€œæŸ¥ç­çº§åŒæ—¶ä¹ŸæŸ¥å‡ºæ‰€æœ‰å­¦ç”Ÿâ€ï¼‰ï¼ŒPageHelper çš„è‡ªåŠ¨åˆ†é¡µå¯èƒ½ä¼šå¯¼è‡´æ•°æ®æ¡æ•°ä¸å¯¹ï¼ˆå®ƒæ˜¯å¯¹ç»“æœé›†åˆ†é¡µï¼Œè€Œä¸æ˜¯å¯¹ä¸»è¡¨åˆ†é¡µï¼‰ã€‚
* **å»ºè®®**ï¼šå¤æ‚çš„å¤šè¡¨å…³è”åˆ†é¡µï¼Œå»ºè®®æ‰‹åŠ¨å†™ SQL æˆ–åœ¨ Service å±‚åˆ†åˆ«æŸ¥è¯¢ç»„è£…ã€‚



!!! success "é€šå…³æ ‡å¿—"
å¦‚æœä½ èƒ½é€šè¿‡ä¿®æ”¹ URL ä¸­çš„ `page` å’Œ `size` å‚æ•°ï¼Œçœ‹åˆ°è¿”å›çš„æ•°æ®éšä¹‹å˜åŒ–ï¼Œä¸” `total` æ€»æ•°æ­£ç¡®ï¼Œè¯´æ˜ä½ å·²ç»æŒæ¡äº†ä¼ä¸šçº§åˆ†é¡µå¼€å‘çš„ç²¾é«“ï¼

[ä¸‹ä¸€æ­¥ï¼šVue3 å‰ç«¯å¯¹æ¥ä¸æ¸²æŸ“ >>](https://www.google.com/search?q=06-vue-integration.md){ .md-button }