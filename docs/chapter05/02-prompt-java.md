---
title: Prompt æç¤ºè¯å·¥ç¨‹ä¸ Java æ¨¡æ¿
---

# 02. æç¤ºè¯å·¥ç¨‹ä¸ Java æ¨¡æ¿

!!! quote "ğŸ“ æœ¬èŠ‚ç›®æ ‡ï¼šä»â€œéšä¾¿èŠèŠâ€åˆ°â€œç²¾å‡†æ§åˆ¶â€"
ä½ æ˜¯å¦å‘ç°ï¼ŒAI æœ‰æ—¶å€™å¾ˆèªæ˜ï¼Œæœ‰æ—¶å€™åˆç­”éæ‰€é—®ï¼Ÿ
é—®é¢˜çš„å…³é”®ä¸åœ¨äº AI ç¬¨ï¼Œè€Œåœ¨äº**ä½ çš„ Prompt (æç¤ºè¯) å†™å¾—ä¸å¤Ÿå¥½**ã€‚

```
ä½œä¸ºåç«¯å¼€å‘ï¼Œæˆ‘ä»¬ä¸èƒ½åƒæ™®é€šç”¨æˆ·é‚£æ ·æ¯æ¬¡æ‰‹æ•²é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦ï¼š
1.  **ç»“æ„åŒ–**ï¼šåŒºåˆ†â€œäººè®¾â€å’Œâ€œæŒ‡ä»¤â€ã€‚
2.  **æ¨¡æ¿åŒ–**ï¼šç”¨ Java ä»£ç åŠ¨æ€ç»„è£… Promptã€‚
3.  **ç¤ºä¾‹åŒ–**ï¼šæ•™ä¼š AI ä¸¾ä¸€åä¸‰ (Few-Shot)ã€‚

```

---

## ğŸ­ ç¬¬ä¸€éƒ¨åˆ†ï¼šPrompt çš„ä¸‰æ˜æ²»ç»“æ„

åœ¨ OpenAI/ModelScope çš„åè®®ä¸­ï¼Œä¸€æ¡å®Œæ•´çš„ Prompt å¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ç”±ä¸åŒè§’è‰²çš„æ¶ˆæ¯ç»„æˆçš„åˆ—è¡¨ã€‚

æœ€ç»å…¸çš„æ˜¯ **System** (ç³»ç»Ÿ/äººè®¾) å’Œ **User** (ç”¨æˆ·/æŒ‡ä»¤) çš„é…åˆã€‚

| è§’è‰² (Role) | ä½œç”¨ | æ¯”å–» |
| --- | --- | --- |
| **System** | è®¾å®š AI çš„è¡Œä¸ºæ¨¡å¼ã€è¯­æ°”ã€èº«ä»½ã€‚ | **å¯¼æ¼”**ï¼šâ€œä½ ç°åœ¨æ˜¯ä¸€ä¸ªèµ„æ·±çš„ Java é¢è¯•å®˜ï¼Œè¯­æ°”è¦ä¸¥å‰ã€‚â€ |
| **User** | ç”¨æˆ·å…·ä½“çš„æé—®æˆ–æŒ‡ä»¤ã€‚ | **æ¼”å‘˜**ï¼šâ€œè¯·é—® HashMap çš„åº•å±‚åŸç†æ˜¯ä»€ä¹ˆï¼Ÿâ€ |
| **Assistant** | AI çš„å›å¤å†å² (ç”¨äºå¤šè½®å¯¹è¯)ã€‚ | **æ­æ¡£**ï¼šâ€œ(AI ä¹‹å‰çš„å›ç­”...)â€ |

### âŒ é”™è¯¯ç¤ºèŒƒ (åªæœ‰ User)

> User: "æŠŠè¿™å¥è¯ç¿»è¯‘æˆè‹±æ–‡ï¼šä½ å¥½"

### âœ… æ­£ç¡®ç¤ºèŒƒ (System + User)

> **System**: "ä½ æ˜¯ä¸€ä¸ªç²¾é€šä¸­è‹±äº’è¯‘çš„ç¿»è¯‘å®˜ï¼Œåªèƒ½è¾“å‡ºç¿»è¯‘ç»“æœï¼Œä¸è¦å¤šè¯´è¯ã€‚"
> **User**: "ä½ å¥½"

---

## ğŸ§± ç¬¬äºŒéƒ¨åˆ†ï¼šJava æ–°ç‰¹æ€§â€”â€”æ–‡æœ¬å— (Text Blocks)

åœ¨ JDK 13 ä»¥å‰ï¼Œè¦åœ¨ Java é‡Œæ‹¼æ¥ä¸€ä¸ªå¤šè¡Œçš„ Prompt æˆ–è€… JSONï¼Œç®€ç›´æ˜¯å™©æ¢¦ï¼š

```java
// âŒ JDK 8 çš„å†™æ³•ï¼šä¸‘é™‹ã€æ˜“é”™ã€éš¾ä»¥é˜…è¯»
String json = "{\n" +
              "  \"role\": \"system\",\n" +
              "  \"content\": \"ä½ æ˜¯ä¸ªåŠ©æ‰‹\"\n" +
              "}";

```

ä» **JDK 15** å¼€å§‹ï¼ŒJava æ­£å¼å¼•å…¥äº† **Text Blocks (æ–‡æœ¬å—)**ï¼Œä½¿ç”¨ `"""` åŒ…è£¹ã€‚è¿™ç®€ç›´æ˜¯ä¸º AI å¼€å‘é‡èº«å®šåšçš„åŠŸèƒ½ï¼

```java
// âœ… JDK 15+ çš„å†™æ³•ï¼šæ¸…çˆ½ã€æ‰€è§å³æ‰€å¾—
String json = """
    {
        "role": "system",
        "content": "ä½ æ˜¯ä¸ªåŠ©æ‰‹"
    }
    """;

```

é…åˆ `.formatted()` æ–¹æ³•ï¼ˆç›¸å½“äº `String.format` çš„ç®€åŒ–ç‰ˆï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åˆ›å»º **Prompt æ¨¡æ¿**ã€‚

---

## ğŸ§  ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ€å·§â€”â€”Few-Shot (å°‘æ ·æœ¬æç¤º)

è¿™æ˜¯ Prompt Engineering ä¸­**æ€§ä»·æ¯”æœ€é«˜**çš„æŠ€å·§ã€‚
ä¸è¦åªå‘Šè¯‰ AI â€œåšä»€ä¹ˆâ€ï¼Œè€Œæ˜¯**ç»™å®ƒçœ‹å‡ ä¸ªâ€œæˆåŠŸçš„ä¾‹å­â€**ã€‚

### åœºæ™¯ï¼šæƒ…æ„Ÿåˆ†æ

æˆ‘ä»¬å¸Œæœ› AI åˆ¤æ–­ç”¨æˆ·è¯„è®ºæ˜¯â€œæ­£é¢â€è¿˜æ˜¯â€œè´Ÿé¢â€ï¼Œå¹¶åªè¿”å› `POSITIVE` æˆ– `NEGATIVE`ã€‚

#### Zero-Shot (é›¶æ ·æœ¬ - ç›´æ¥é—®)

> **User**: "è¿™å®¶åº—å¾ˆéš¾åƒã€‚æ˜¯æ­£é¢è¿˜æ˜¯è´Ÿé¢ï¼Ÿ"
> **AI**: "è¿™å¥è¯è¡¨è¾¾äº†å¯¹é£Ÿç‰©çš„ä¸æ»¡ï¼Œæ‰€ä»¥æ˜¯è´Ÿé¢è¯„ä»·ã€‚" (åºŸè¯å¤ªå¤šï¼Œä¸å¥½è§£æ)

#### Few-Shot (å°‘æ ·æœ¬ - ç»™ä¾‹å­)

> **User**:
> è¿™æ˜¯ä¸€ä¸ªæƒ…æ„Ÿåˆ†æä»»åŠ¡ã€‚
> ä¾‹å­ 1ï¼š
> è¾“å…¥ï¼š"å‘³é“ä¸é”™" -> è¾“å‡ºï¼šPOSITIVE
> ä¾‹å­ 2ï¼š
> è¾“å…¥ï¼š"æœåŠ¡å‘˜æ€åº¦å¾ˆå·®" -> è¾“å‡ºï¼šNEGATIVE
> è¯·åˆ†æä»¥ä¸‹è¾“å…¥ï¼š"è¿™å®¶åº—å¾ˆéš¾åƒ" -> è¾“å‡ºï¼š

> **AI**: "NEGATIVE" (éå¸¸å¬è¯)

---

## ğŸ’» ç¬¬å››éƒ¨åˆ†ï¼šä»£ç å®æˆ˜

æˆ‘ä»¬å°†ç»“åˆ **System äººè®¾**ã€**æ–‡æœ¬å—** å’Œ **Few-Shot**ï¼Œå†™ä¸€ä¸ªâ€œæ™ºèƒ½æƒ…æ„Ÿåˆ†æå™¨â€ã€‚

åœ¨ `src/test/java` ä¸‹æ–°å»º `PromptTest.java`ã€‚

```java title="PromptTest.java"
package com.example.demo;

import org.junit.jupiter.api.Test;
import org.springframework.http.MediaType;
import org.springframework.web.client.RestClient;

@SpringBootTest
public class PromptTest {

    private static final String API_KEY = "sk-ä½ çš„Token";
    private static final String API_URL = "https://api-inference.modelscope.cn/v1/chat/completions";

    @Test
    void testSentimentAnalysis() {
        // ==========================================
        // 1. å®šä¹‰ Prompt æ¨¡æ¿ (Java æ–‡æœ¬å—)
        // ==========================================
        
        // System Prompt: ç¡®ç«‹äººè®¾
        String systemPrompt = "ä½ æ˜¯ä¸€ä¸ªæƒ…æ„Ÿåˆ†æä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼Œåªè¿”å› 'POSITIVE' æˆ– 'NEGATIVE'ï¼Œä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—ã€‚";

        // User Prompt: åŒ…å« Few-Shot ç¤ºä¾‹ + åŠ¨æ€å˜é‡ (%s)
        String userPromptTemplate = """
            è¿™é‡Œæœ‰ä¸€äº›ç¤ºä¾‹ï¼š
            è¾“å…¥ï¼š"å¿«é€’å¾ˆå¿«ï¼ŒåŒ…è£…å®Œå¥½" -> è¾“å‡ºï¼šPOSITIVE
            è¾“å…¥ï¼š"è™½ç„¶ä¾¿å®œï¼Œä½†æ˜¯è´¨é‡å¤ªå·®äº†" -> è¾“å‡ºï¼šNEGATIVE
            è¾“å…¥ï¼š"è€æ¿äººå¾ˆå¥½ï¼Œä¸‹æ¬¡è¿˜æ¥" -> è¾“å‡ºï¼šPOSITIVE
            
            ç°åœ¨è¯·åˆ†æè¿™ä¸ªè¾“å…¥ï¼š
            è¾“å…¥ï¼š"%s" -> è¾“å‡ºï¼š
            """;

        // æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥
        String userInput = "è¡£æœå¾ˆæ¼‚äº®ï¼Œä½†æ˜¯ç‰©æµå¤ªæ…¢äº†ï¼Œç­‰äº†ä¸€å‘¨ï¼";
        
        // ç»„è£…æœ€ç»ˆçš„ User Prompt
        String finalUserPrompt = userPromptTemplate.formatted(userInput);

        // ==========================================
        // 2. æ„å»º JSON è¯·æ±‚ä½“
        // ==========================================
        // æ³¨æ„ï¼šè¿™é‡Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ç›´æ¥æ‹¼ JSONã€‚
        // çœŸå®é¡¹ç›®ä¸­ï¼Œå¦‚æœ input åŒ…å«æ¢è¡Œæˆ–å¼•å·ï¼Œç›´æ¥æ‹¼ä¼šæŠ¥é”™ã€‚ä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šç”¨ JSON åº“æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
        String jsonBody = """
            {
                "model": "deepseek-ai/DeepSeek-R1-0528",
                "messages": [
                    {
                        "role": "system", 
                        "content": "%s"
                    },
                    {
                        "role": "user", 
                        "content": "%s"
                    }
                ]
            }
            """.formatted(systemPrompt, finalUserPrompt.replace("\n", "\\n").replace("\"", "\\\"")); 
            // ğŸ‘† ç®€å•çš„è½¬ä¹‰å¤„ç†ï¼Œé˜²æ­¢ JSON æ ¼å¼ç ´æŸ

        // ==========================================
        // 3. å‘é€è¯·æ±‚
        // ==========================================
        RestClient client = RestClient.builder()
                .baseUrl(API_URL)
                .defaultHeader("Authorization", "Bearer " + API_KEY)
                .build();

        System.out.println("ğŸ¤– æ­£åœ¨åˆ†ææƒ…æ„Ÿ...");
        String response = client.post()
                .contentType(MediaType.APPLICATION_JSON)
                .body(jsonBody)
                .retrieve()
                .body(String.class);

        System.out.println("âœ… AI åŸå§‹å›å¤: " + response);
    }
}

```

### è¿è¡Œç»“æœé¢„æœŸ

ç”±äºæˆ‘ä»¬ä½¿ç”¨äº† **System é™å®š** å’Œ **Few-Shot å¼•å¯¼**ï¼ŒAI åº”è¯¥ä¼šéå¸¸å…‹åˆ¶ï¼Œåªè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼ˆå¯èƒ½ DeepSeek-R1 ä¼šå…ˆè¾“å‡º `<think>`ï¼Œä½†æœ€ç»ˆç»“è®ºä¼šå¾ˆæ ‡å‡†ï¼‰ã€‚

```json
{
  ...
  "content": "<think>...</think>NEGATIVE"
}

```

---

## âš ï¸ ç—›ç‚¹é¢„å‘Šï¼šJSON æ‹¼æ¥çš„é£é™©

ä»”ç»†çœ‹ä¸Šé¢çš„ä»£ç ï¼Œä¸ºäº†æŠŠ prompt å¡è¿› JSONï¼Œæˆ‘ä¸å¾—ä¸å†™äº†è¿™æ ·ä¸€è¡Œä»£ç ï¼š

```java
finalUserPrompt.replace("\n", "\\n").replace("\"", "\\\"")

```

è¿™æ˜¯éå¸¸å±é™©ä¸”ä¸ä¼˜é›…çš„ï¼

* å¦‚æœç”¨æˆ·è¾“å…¥é‡Œæœ‰å¤æ‚çš„å­—ç¬¦ï¼ˆæ¯”å¦‚ Emojiã€Tabï¼‰ï¼Œæ‰‹å†™æ›¿æ¢å¾ˆå®¹æ˜“æ¼æ‰ï¼Œå¯¼è‡´ JSON æ ¼å¼é”™è¯¯ï¼ˆ400 Bad Requestï¼‰ã€‚
* ä»£ç é‡Œå……æ–¥ç€å¤§é‡çš„è½¬ä¹‰ç¬¦ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚

**å¦‚ä½•ä¼˜é›…åœ°æŠŠ Java å¯¹è±¡è½¬æ¢æˆ JSONï¼Œå¹¶è®© AI ç¨³å®šåœ°è¿”å› JSON æ ¼å¼çš„æ•°æ®ï¼Ÿ**
ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°†å¼•å…¥ **Jackson** å’Œ **JSON Schema**ï¼Œè®©ç¨‹åºäº¤äº’å˜å¾—çœŸæ­£â€œä¸“ä¸šåŒ–â€ã€‚

---

## ğŸ“ æ€»ç»“

1. **ç»“æ„åŒ–**ï¼šPrompt ä¸æ˜¯ä¸€å¥è¯ï¼Œè€Œæ˜¯ `System` (äººè®¾) + `User` (æŒ‡ä»¤) çš„ç»„åˆã€‚
2. **å·¥å…·**ï¼šä½¿ç”¨ Java 15+ çš„ **Text Blocks (`"""`)** å’Œ `.formatted()`ï¼Œè®© Prompt ä»£ç æ¸…æ™°å¯è¯»ã€‚
3. **å¿ƒæ³•**ï¼š**Few-Shot (å°‘æ ·æœ¬)** æ˜¯æé«˜ AI å‡†ç¡®ç‡çš„ç¥å™¨ï¼Œç»™å®ƒå‡ ä¸ªä¾‹å­ï¼Œå®ƒå°±èƒ½æ‡‚ä½ çš„è§„çŸ©ã€‚

[ä¸‹ä¸€èŠ‚ï¼šè®© AI è¯´â€œæœºå™¨è¯â€ï¼šJSON Schema ä¸è§£æ](03-structured-output.md){ .md-button .md-button--primary }