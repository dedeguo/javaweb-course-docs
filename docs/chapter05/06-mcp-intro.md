---
title: æœªæ¥çš„æ ‡å‡†ï¼šMCP (Model Context Protocol) ç®€ä»‹
---
# 05. æœªæ¥çš„æ ‡å‡†ï¼šMCP (Model Context Protocol) ç®€ä»‹

!!! quote "ğŸ”Œ æœ¬èŠ‚ç›®æ ‡ï¼šä»â€œæ‰‹æ“çº¿ç¼†â€åˆ°â€œUSB å³æ’å³ç”¨â€"
    åœ¨ç¬¬å››èŠ‚ä¸­ï¼Œä¸ºäº†è®© AI æŸ¥ä¸€ä¸ªä¹¦ä»·ï¼Œæˆ‘ä»¬å†™äº†æ•´æ•´ 50 è¡Œä»£ç æ¥å®šä¹‰ JSON Schemaã€è§£æå‚æ•°ã€å›ä¼ ç»“æœã€‚
    åœ¨ç¬¬äº”èŠ‚ä¸­ï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªTool Calling æ¥å¯¹æ¥AIå®ŒæˆæŸ¥ä¹¦çš„åŠŸèƒ½ã€‚
    
    è¯•æƒ³ä¸€ä¸‹ï¼šå¦‚æœä½ æƒ³æŠŠä½ çš„ **MySQL æ•°æ®åº“**ã€**æœ¬åœ°æ—¥å¿—æ–‡ä»¶**ã€**Home Lab é‡Œçš„ NAS** å…¨éƒ¨å¼€æ”¾ç»™ AIï¼Œéš¾é“è¦ä¸ºæ¯ä¸€ä¸ªæœåŠ¡éƒ½æ‰‹å†™ä¸€é Tool Calling ä»£ç å—ï¼Ÿ
    
    **MCP (Model Context Protocol)** çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªâ€œè¿æ¥å™©æ¢¦â€ã€‚å®ƒæ˜¯ AI æ—¶ä»£çš„ **USB åè®®**ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†ä½¿ç”¨ Spring AI æœ€æ–°çš„ **MCP Client Starter**ï¼Œæ¼”ç¤ºå¦‚ä½•ä¸€è¡Œä»£ç ä¸å†™ï¼Œç»™ AI è£…ä¸Šâ€œé«˜å¾·åœ°å›¾â€ã€‚

---

## ğŸ•¸ï¸ ç¬¬ä¸€éƒ¨åˆ†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ MCPï¼Ÿ

### ç°çŠ¶ï¼šå·´åˆ«å¡”çš„æ··ä¹±
ç›®å‰ï¼Œæ¯å®¶ AI å‚å•†çš„è¿æ¥æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼š

* **OpenAI** æœ‰è‡ªå·±çš„ Assistants APIã€‚
* **Claude** æœ‰è‡ªå·±çš„ Tool Use æ ¼å¼ã€‚
* **LangChain** æœ‰è‡ªå·±çš„å°è£…ã€‚

å¦‚æœä½ å†™äº†ä¸€ä¸ª Java æ–¹æ³• `queryStudentInfo()`ï¼Œä½ æƒ³è®© Cursor ç¼–è¾‘å™¨èƒ½ç”¨å®ƒï¼Œæƒ³è®© Claude Desktop èƒ½ç”¨å®ƒï¼Œåˆæƒ³è®©è‡ªå·±çš„ Web å®˜ç½‘èƒ½ç”¨å®ƒï¼Œä½ éœ€è¦å†™ä¸‰å¥—é€‚é…ä»£ç ã€‚è¿™å°±æ˜¯**æ•°æ®å­¤å²›**ã€‚

### è§£å†³æ–¹æ¡ˆï¼šMCP åè®®

**MCP (Model Context Protocol)** æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ã€‚å®ƒè§„å®šäº†ï¼š  
1.  **AI åº”è¯¥æ€ä¹ˆé—®**ï¼ˆæ ‡å‡†åŒ–çš„è¯·æ±‚æ ¼å¼ï¼‰ã€‚  
2.  **ç¨‹åºåº”è¯¥æ€ä¹ˆç­”**ï¼ˆæ ‡å‡†åŒ–çš„èµ„æºã€æç¤ºè¯å’Œå·¥å…·æ ¼å¼ï¼‰ã€‚  

**ä¸€å¥è¯æ€»ç»“**ï¼šåªè¦ä½ çš„ Java ç¨‹åºæ”¯æŒ MCP æ ‡å‡†ï¼Œå®ƒå°±å¯ä»¥è¢«**ä»»ä½•**æ”¯æŒ MCP çš„ AI å®¢æˆ·ç«¯ç›´æ¥è¿æ¥ï¼Œæ— éœ€æ”¹ä»£ç ï¼

---

## ğŸ—ï¸ ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒæ¶æ„ä¸‰å‰‘å®¢

MCP çš„æ¶æ„éå¸¸åƒæˆ‘ä»¬ç†Ÿæ‚‰çš„ C/S (å®¢æˆ·ç«¯/æœåŠ¡ç«¯) æ¨¡å¼ï¼š

| è§’è‰² | æ¯”å–» | èŒè´£ | æœ¬æ¡ˆä¾‹ä¸­çš„å¯¹åº” |
| :--- | :--- | :--- | :--- |
| **MCP Host** | **ç”µè„‘ä¸»æœº** | è¿è¡Œ AI æ¨¡å‹çš„ä¸»ç¨‹åºã€‚ | **ä½ çš„ Spring Boot åº”ç”¨** |
| **MCP Client** | **USB æ¥å£** | Host å†…éƒ¨çš„è¿æ¥å™¨ã€‚ | **Spring AI MCP Starter** |
| **MCP Server** | **U ç›˜ / é¼ æ ‡** | æä¾›æ•°æ®å’Œå·¥å…·èƒ½åŠ›ã€‚ | **é«˜å¾·åœ°å›¾ MCP æœåŠ¡ (äº‘ç«¯)** |

```mermaid
graph LR
    subgraph Host [ä½ çš„ Spring Boot åº”ç”¨]
        A[AiController] --> B[MCP Client ]
    end

    subgraph Server [ äº‘ç«¯æœåŠ¡]
        C[é«˜å¾·åœ°å›¾ MCP Server]
    end
    
    subgraph AMap [é«˜å¾·å¼€æ”¾å¹³å°]
        D[API æ¥å£]
    end

    B -- "SSE (HTTPæµå¼åè®®)" --> C
    C -- "è°ƒç”¨ API" --> D

```

---


## ğŸš€ ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®æˆ˜ - ç»™ AI è£…ä¸Šâ€œé«˜å¾·åœ°å›¾â€

ä»¥å‰æˆ‘ä»¬è¦è®© AI å…·å¤‡æŸ¥è¯¢è·¯çº¿çš„èƒ½åŠ›ï¼Œéœ€è¦åœ¨ Java ä»£ç é‡Œå†™ä¸€å † HTTP è¯·æ±‚å»å¯¹æ¥é«˜å¾· APIã€‚
ç°åœ¨ï¼Œåˆ©ç”¨ **Spring AI MCP Client**ï¼Œæˆ‘ä»¬åªéœ€è¦åšé…ç½®ï¼Œ**ä¸éœ€è¦å†™ä»»ä½•å·¥å…·å®šä¹‰ä»£ç **ã€‚

### æ­¥éª¤ 1ï¼šéƒ¨ç½² MCP Server (æœåŠ¡ç«¯)

æˆ‘ä»¬åœ¨ **ModelScope (é­”æ­)** å¹³å°ä¸Šï¼Œä½¿ç”¨ç°æˆçš„é«˜å¾· MCP Serverã€‚

1. è®¿é—® ModelScope çš„MCPä¸“åŒºï¼š[ https://www.modelscope.cn/mcp](https://www.modelscope.cn/mcp)ï¼Œæ‰¾åˆ°[é«˜å¾·åœ°å›¾çš„MCP](https://www.modelscope.cn/mcp/servers/@amap/amap-maps)ã€‚
2. é€‰æ‹©`Remote`, ä¼ è¾“ç±»å‹é€‰æ‹©`SSE`, å¡«å…¥ `AMAP_MAPS_API_KEY` (ä½ ç”³è¯·çš„é«˜å¾· API_Key)ã€‚
![é«˜å¾·MCPé…ç½®](../assets/imgs/mcp/gd_mcp_config.png){ width="50%" height="200px" .shadow }![é«˜å¾·MCPé…ç½®æˆåŠŸ](../assets/imgs/mcp/gd_mcp_config_success.png){ width="50%" height="200px" .shadow }
3. ç‚¹å‡»è¿æ¥ï¼Œè·å¾—ä¸€ä¸ª **SSE URL** (ä¾‹å¦‚ï¼š`https://mcp.api-inference.modelscope.net/35ab39184eba47/sse`)ã€‚

> *æ³¨ï¼šè¿™ä¸ª Server æ˜¯åˆ«äººå†™å¥½çš„ï¼Œç¬¦åˆ MCP æ ‡å‡†ï¼Œæˆ‘ä»¬ç›´æ¥è¿å°±è¡Œï¼*

éƒ¨ç½²å®Œæˆåï¼Œä½ ä¼šè·å¾—ä¸€ä¸ª **SSE URL**ã€‚
å½“æˆ‘ä»¬å°†è¿™ä¸ª URL å¡«å…¥ **MCP Client** (å¦‚ [Cherry Studio](https://www.cherry-ai.com/) æˆ–æˆ‘ä»¬çš„ Java ç¨‹åº) åï¼ŒAI ç¬é—´å°±å­¦ä¼šäº†ä»¥ä¸‹æŠ€èƒ½ï¼š

* `amap_weather_info`: æŸ¥è¯¢å¤©æ°”ã€‚
* `amap_search_places`: æœç´¢åœ°ç‚¹ï¼ˆæ‰¾ç¾é£Ÿã€æ‰¾åŠ æ²¹ç«™ï¼‰ã€‚
* `amap_direction_driving`: è§„åˆ’é©¾è½¦è·¯çº¿ã€‚


### æ­¥éª¤ 2ï¼šå¼•å…¥ Maven ä¾èµ–

åœ¨ `pom.xml` ä¸­å¼•å…¥ Spring AI çš„ MCP å®¢æˆ·ç«¯å¯åŠ¨å™¨ï¼š

```xml
<dependency>
    <groupId>org.springframework.ai</groupId>
    <artifactId>spring-ai-starter-mcp-client</artifactId>
</dependency>

```

### æ­¥éª¤ 3ï¼šé…ç½® application.properties

è¿™æ˜¯æœ€ç¥å¥‡çš„ä¸€æ­¥ã€‚æˆ‘ä»¬ä¸éœ€è¦å†™ Java ä»£ç æ¥æ³¨å†Œå·¥å…·ï¼Œåªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å‘Šè¯‰ Spring Boot å»å“ªé‡Œè¿æ¥ MCP Serverã€‚

```properties
# 1. å¼€å¯ MCP åŠŸèƒ½
spring.ai.mcp.client.enabled=true
spring.mvc.async.request-timeout=600000
spring.ai.mcp.client.type=ASYNC

# 2. é…ç½®é«˜å¾· MCP Server çš„è¿æ¥ä¿¡æ¯
# ç»™è¿™ä¸ªè¿æ¥èµ·ä¸ªåå­—å« amap
# å°†ç”³è¯·åˆ°çš„ SSE URL:https://mcp.api-inference.modelscope.net/35ab39184eba47/sse 
# åˆ†æˆä¸¤éƒ¨åˆ†åˆ«å¡«å…¥åˆ°urlå’Œsse-endpoint
spring.ai.mcp.client.sse.connections.amap.url=https://mcp.api-inference.modelscope.net
spring.ai.mcp.client.sse.connections.amap.sse-endpoint=/35ab39184eba47/sse
```

### æ­¥éª¤ 4ï¼šç¼–å†™ Controller

åœ¨ `AiController` ä¸­ï¼Œæˆ‘ä»¬åƒå¾€å¸¸ä¸€æ ·ä½¿ç”¨ `ChatClient`ã€‚Spring AI ä¼šè‡ªåŠ¨æ‰«æé…ç½®å¥½çš„ MCP Serverï¼Œå‘ç°é‡Œé¢çš„å·¥å…·ï¼ˆæŸ¥å¤©æ°”ã€æœåœ°ç‚¹ç­‰ï¼‰ï¼Œå¹¶è‡ªåŠ¨æŒ‚è½½åˆ° `ChatClient` ä¸Šã€‚

```java
@RestController
@RequestMapping("/ai")
public class AiController {

    private final ChatClient chatClient;

    // æ„é€ å™¨æ³¨å…¥ï¼šSpring AI è‡ªåŠ¨é…ç½®å¥½çš„ Builder
    public AiController(ChatClient.Builder builder, List<McpAsyncClient> mcpAsyncClients) {
        this.chatClient = builder
                .defaultToolCallbacks(new AsyncMcpToolCallbackProvider(mcpAsyncClients))
                .build();
    }

    @GetMapping("/chat")
    public String chat(@RequestParam String message) {
        // ğŸš€ æ ¸å¿ƒï¼šè¿™é‡Œä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®š .functions(...)
        // MCP Starter å·²ç»è‡ªåŠ¨æŠŠè¿œç¨‹çš„é«˜å¾·å·¥å…·â€œæ’â€è¿›æ¥äº†
        return chatClient.prompt(message)
                .call()
                .content();
    }
}
```

---

###  è¿™ä¸ªæ¡ˆä¾‹è¯´æ˜äº†ä»€ä¹ˆï¼Ÿ

* **å³æ’å³ç”¨**ï¼šé«˜å¾·åœ°å›¾å®˜æ–¹ï¼ˆæˆ–ç¤¾åŒºï¼‰å†™å¥½äº†ä¸€æ¬¡ MCP Serverï¼Œå…¨ä¸–ç•Œçš„ AI éƒ½èƒ½ç›´æ¥ç”¨ï¼Œä¸éœ€è¦æ¯ä¸ªå¼€å‘è€…é‡å¤é€ è½®å­ã€‚
* **äº‘ç«¯ä¸æœ¬åœ°çš„è¿æ¥**ï¼šä½ çš„ Java ç¨‹åºè¿è¡Œåœ¨æœ¬åœ°ï¼Œé«˜å¾· MCP è¿è¡Œåœ¨äº‘ç«¯ (ModelScope)ï¼Œä¸¤è€…é€šè¿‡ MCP åè®®æ— ç¼åä½œã€‚

---

## â˜ï¸ ç¬¬å››éƒ¨åˆ†ï¼šè§è¯é­”æ³•

æ³¨æ„çœ‹ï¼Œæˆ‘ä»¬**ä¸éœ€è¦**å‘Šè¯‰ AI â€œé«˜å¾·åœ°å›¾çš„ API æ–‡æ¡£æ˜¯ä»€ä¹ˆâ€ï¼Œä¹Ÿä¸éœ€è¦å®šä¹‰ Schemaã€‚è¿æ¥æˆåŠŸåï¼Œç›´æ¥é—®ï¼š
å¯åŠ¨ Spring Boot åº”ç”¨ï¼Œè®¿é—®ä½ çš„æ¥å£ï¼š

**è¯·æ±‚ URL**ï¼š
`http://localhost:8080/ai/chat?message=æˆ‘åœ¨æ­¦æ±‰å·¥å•†å­¦é™¢ï¼Œæƒ³å»æœ€è¿‘çš„èŒ¶é¢œæ‚¦è‰²å–å¥¶èŒ¶ï¼Œå¼€è½¦è¦å¤šä¹…ï¼Ÿ`

**åå°å‘ç”Ÿçš„çœŸå®äº¤äº’ (Logs)**ï¼š

1. **Spring Boot (Client)** è¿æ¥åˆ° **ModelScope (Server)**ã€‚
2. Client è¯¢é—®ï¼šâ€œä½ æœ‰å“ªäº›æœ¬äº‹ï¼Ÿâ€ Server å›ç­”ï¼šâ€œæˆ‘ä¼š `amap_search_places` å’Œ `amap_direction_driving`â€ã€‚
3. **AI (å¤§æ¨¡å‹)** æ€è€ƒåå†³å®šè°ƒç”¨å·¥å…·ã€‚
4. Client å‘é€æŒ‡ä»¤ç»™ Serverï¼š`execute amap_search_places("èŒ¶é¢œæ‚¦è‰²", "æ­¦æ±‰")`ã€‚
5. Server è¿”å›ï¼šâ€œæœ€è¿‘çš„æ˜¯ç™½æ²™æ´²åº—...â€ã€‚
6. Client å†æ¬¡å‘é€æŒ‡ä»¤ï¼š`execute amap_direction_driving(...)`ã€‚
7. Server è¿”å›ï¼šâ€œè€—æ—¶ 15 åˆ†é’Ÿâ€ã€‚

**æµè§ˆå™¨å“åº”**ï¼š

> "å¸®ä½ æŸ¥åˆ°äº†ï¼Œè·ç¦»æ­¦æ±‰å·¥å•†å­¦é™¢æœ€è¿‘çš„èŒ¶é¢œæ‚¦è‰²æ˜¯**ç™½æ²™æ´²åº—**ï¼Œå¤§çº¦ 3.5 å…¬é‡Œã€‚ç›®å‰è·¯å†µé€šç•…ï¼Œ**å¼€è½¦å¤§çº¦éœ€è¦ 15 åˆ†é’Ÿ**ã€‚"

---

## ğŸ†š æ€»ç»“ï¼šTool Calling vs MCP

| ç‰¹æ€§ | Tool Calling  | MCP |
| --- | --- | --- |
| **è¿æ¥æ–¹å¼** | **ç¡¬ç¼–ç ** (Hardcoded) | **æ ‡å‡†åŒ–åè®®** (Standard Protocol) |
| **ä»£ç é‡** | 50+ è¡Œ (å®šä¹‰ Request, Response, Function) | **0 è¡Œ** (ä»…é…ç½®) |
| **å‘ç°æœºåˆ¶** | æ‰‹åŠ¨å‘Šè¯‰ AI æœ‰å“ªäº›å·¥å…· | AI è‡ªåŠ¨è¯¢é—® Server æœ‰å“ªäº›èƒ½åŠ› |
| **å¤ç”¨æ€§** | ä½ (åªèƒ½å½“å‰é¡¹ç›®ç”¨) | **æé«˜** (ä»»ä½•æ”¯æŒ MCP çš„ AI éƒ½èƒ½è¿) |
| **ç»´æŠ¤æˆæœ¬** | é«˜ (é«˜å¾· API å˜äº†ä½ è¦æ”¹ä»£ç ) | **ä½** (æœåŠ¡ç«¯å‡çº§ï¼Œå®¢æˆ·ç«¯æ— æ„Ÿ) |
| **æ¨¡å¼** | æœ¬åœ°ç¡¬ç¼–ç  | **è¿œç¨‹å³æ’å³ç”¨** |

**æ€»ç»“ï¼š MCP çš„ä»·å€¼**  
**æ ‡å‡†åŒ–**: ä½ ä¸å†éœ€è¦ä¸ºæ¯ä¸ªå¤–éƒ¨å·¥å…·å†™ç‰¹å®šçš„ Java ä»£ç  (Function<T, R>)ã€‚åªè¦è¯¥å·¥å…·ç¬¦åˆ MCP æ ‡å‡†ï¼ŒSpring AI å°±èƒ½ç›´æ¥â€œæ’æ‹”â€ä½¿ç”¨ã€‚  
**è§£è€¦**: å®é™…çš„å·¥å…·é€»è¾‘ï¼ˆPython, TS, Goï¼‰ä¸ Spring AI åº”ç”¨é€»è¾‘åˆ†ç¦»ã€‚  
**ç”Ÿæ€å¤ç”¨**: ä½ å¯ä»¥ç›´æ¥è¿æ¥ç¤¾åŒºç°æœ‰çš„ MCP Serverï¼ˆå¦‚ Google Drive, Slack, Postgresï¼‰ï¼Œè€Œæ— éœ€é‡æ–°é€ è½®å­ã€‚  

### ğŸ”® å±•æœ›

**MCP æ˜¯ AI åº”ç”¨å¼€å‘çš„ä¸‹ä¸€ä¸ªé‡Œç¨‹ç¢‘ã€‚**

åœ¨æœªæ¥çš„ **Agent å¼€å‘** ä¸­ï¼Œä½ å°†ä¸å†æ˜¯ä¸€ä¸ªâ€œå†™æ¥å£çš„äººâ€ï¼Œè€Œæ˜¯ä¸€ä¸ª**â€œè¿æ¥è€…â€**ï¼Œè€Œæ˜¯ä¸€ä¸ª**â€œä¸º AI æ„å»ºæ„ŸçŸ¥å™¨å®˜ï¼ˆContextï¼‰å’Œæ‰§è¡Œå™¨å®˜ï¼ˆToolsï¼‰çš„é€ ç‰©ä¸»â€**ã€‚ä½ åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œå¡«å…¥å„ç§ MCP Server çš„åœ°å€ï¼ˆæ•°æ®åº“ MCPã€æ–‡ä»¶ç³»ç»Ÿ MCPã€å¾®ä¿¡ MCP...ï¼‰ï¼Œä½ çš„ AI å°±ç¬é—´æ‹¥æœ‰äº†ä¸‰å¤´å…­è‡‚ã€‚

---

!!! success "ç¬¬äº”ç« é€šå…³"
    æ­å–œä½ å®Œæˆäº† **ã€ŠJava ä¸ AI çš„æ¡æ‰‹ã€‹** è¿™ä¸€ç« ï¼

    1.  ä½ å­¦ä¼šäº†æŠŠ Java å½“æµè§ˆå™¨ç”¨ (**Http Client**)ã€‚
    2.  ä½ å­¦ä¼šäº†ç”¨ Java ç®¡ç†æç¤ºè¯ (**Prompt**)ã€‚
    3.  ä½ å­¦ä¼šäº†è®© AI è¯´äººè¯ (**JSON Parsing**)ã€‚
    4.  ä½ ç”šè‡³èµ‹äºˆäº† AI åŒæ‰‹ (**Tool Calling**)ã€‚
    5.  ä½ è¿˜äº†è§£äº†æœªæ¥çš„æ ‡å‡† (**MCP**)ã€‚


[è¿”å›ç›®å½•](index.md){ .md-button }




