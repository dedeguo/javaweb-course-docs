---
title: 实验2：用户登录与数据API
---

# 实验2：用户登录与数据API

!!! abstract "实验信息"
    - **实验学时**：2 学时
    - **实验类型**：验证性
    - **核心目标**：用最小可运行的方式体验 Cookie/Session 机制，并学会用接口测试工具验证登录态。

---

## 一、实验目的

1. 通过一次“登录 → 访问受保护资源”的流程，理解 **Cookie 与 Session 的配合机制**。
2. 学会用 Apifox/Postman 验证：`Set-Cookie` 是否下发、后续请求是否携带 `Cookie`。
3. 形成调试习惯：遇到问题先看 **状态码 + Header + 后端日志**。

---

## 二、实验要求（本课程口径）

!!! warning "范围控制（符合大纲删减项）"
    - 不要求 JSP 页面
    - 不要求复杂 `web.xml`
    - 不要求用纯 Servlet 做完整 CRUD

---

## 三、实验任务

### 任务 1：实现登录接口（/login）

要求：

- 接收 `POST /login`
- 参数：`username`、`password`（表单参数或 JSON 二选一即可）
- 校验规则（简化）：`username=admin` 且 `password=123` 视为成功
- **登录成功后必须写入 Session**（例如存 `currentUser` 或 `userId`）
- 返回 JSON（格式不强制，但要能看出成功/失败）

### 任务 2：实现受保护接口（/me 或 /home）

要求：

- 接收 `GET /me`（或 `/home`）
- 从 Session 读取登录信息
- 未登录：返回“未登录”提示（建议使用 `401` 或 `200` + 业务码，二选一）
- 已登录：返回当前用户信息（例如用户名）

### 任务 3：实现退出登录（可选，加分）（/logout）

要求：

- 接收 `POST /logout`
- 使当前 Session 失效（`invalidate`）
- 返回 JSON

---

## 四、接口测试（评分重点）

使用 Apifox/Postman 按顺序完成，并截图：

1. **未登录访问**：直接请求受保护接口（例如 `GET /me`），截图保存（截图 A）。
2. **登录**：请求 `POST /login`，在响应头中找到 `Set-Cookie`，截图保存（截图 B）。
3. **已登录访问**：再次请求 `GET /me`，确认请求头中携带 `Cookie` 且返回用户信息，截图保存（截图 C）。
4. **（可选）退出后访问**：调用 `/logout` 后再次访问 `/me`，确认恢复为未登录状态，截图保存（截图 D）。

!!! tip "怎么快速定位问题？"
    - 没有 `Set-Cookie`：看后端是否真的创建了 Session；看是否被重定向/异常打断  
    - 有 `Set-Cookie` 但后续不带 `Cookie`：看 Apifox/Postman 是否开启“自动跟随 Cookie/会话”  
    - 带了 `Cookie` 仍未登录：检查服务端是否在同一端口/同一应用内处理请求（Session 在服务端存放）

---

## 五、提交要求

1. 实验代码（按课程要求提交到 Git 仓库）
2. 截图 A/B/C（D 可选）
3. （可选）一句话说明：你是如何在请求头/响应头里验证 Session 的

