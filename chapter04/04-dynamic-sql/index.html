
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="武汉工商学院《Java Web开发技术》课程电子教材">
      
      
      
        <link rel="canonical" href="https://dedeguo.github.io/javaweb-course-docs/chapter04/04-dynamic-sql/">
      
      
        <link rel="prev" href="../03-mapper-xml/">
      
      
        <link rel="next" href="../05-pagehelper/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>MyBatis 的杀手锏：动态 SQL - Java Web 开发技术</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unpkg.com/mermaid/dist/mermaid.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#04-mybatis-sql" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="Java Web 开发技术" class="md-header__button md-logo" aria-label="Java Web 开发技术" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Java Web 开发技术
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MyBatis 的杀手锏：动态 SQL
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Java Web 开发技术" class="md-nav__button md-logo" aria-label="Java Web 开发技术" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Java Web 开发技术
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    课程介绍
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    课程介绍
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../chapter01/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    第一篇｜开发环境与效能工具
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    第一篇｜开发环境与效能工具
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter01/01-env-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01.开发环境安装
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter01/02-maven-git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02.工程化基石：Git与Maven
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter01/03-ai-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03.AI 结对编程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter01/lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    实验1：Web环境与AI助手
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../chapter02/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    第二篇｜Web 底层原理
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    第二篇｜Web 底层原理
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter02/01-http-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01.HTTP 协议与调试工具
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter02/02-servlet-basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02. Servlet 基础
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter02/03-request-response/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03. 请求与响应 (Req & Resp)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter02/04-json-interaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    04. JSON 数据交互
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter02/05-state-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    05. 会话与状态 (Session)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter02/06-filter-listener/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    06. 过滤器与监听器
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter02/07-jdbc-core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    07. JDBC 与连接池 Druid
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter02/lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    实验 2：Web 核心综合实战
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../chapter03/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    第三篇｜Spring Boot 核心开发
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    第三篇｜Spring Boot 核心开发
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter03/01-springboot-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01. 框架革命：Spring Boot 快速入门
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter03/02-ioc-di/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02. 核心原理：IOC 容器与依赖注入 (DI)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter03/03-restful-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03. 接口规范：RESTful 风格与统一响应
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter03/04-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    04. 架构设计：分层解耦 (Controller-Service-Dao)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter03/05-exception-aop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    05. 全局兜底：异常处理与 AOP 简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter03/06-test-logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    06. 生产级基石：日志管理与单元测试
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter03/lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    实验3：构建标准化的 RESTful 后端系统
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    第四篇｜MyBatis 数据持久化
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    第四篇｜MyBatis 数据持久化
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-orm-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01. ORM 思想与 MyBatis 初探
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-integrate-mysql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02. 整合数据库 (Spring Boot + MySQL)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-mapper-xml/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03. Mapper接口与XML映射
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    04. MyBatis 的杀手锏：动态 SQL
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    04. MyBatis 的杀手锏：动态 SQL
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#if-where" class="md-nav__link">
    <span class="md-ellipsis">
      
        🚦 场景一：智能条件查询 (&lt;if&gt; 与 &lt;where&gt;)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🚦 场景一：智能条件查询 (&lt;if&gt; 与 &lt;where&gt;)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 业务痛点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. MyBatis 的解决方案
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-where" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. &lt;where&gt; 标签的魔法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    <span class="md-ellipsis">
      
        🛠️ 场景二：智能更新 (&lt;set&gt;)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🛠️ 场景二：智能更新 (&lt;set&gt;)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 业务痛点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 实战代码
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foreach" class="md-nav__link">
    <span class="md-ellipsis">
      
        🚀 场景三：批量操作 (&lt;foreach&gt;)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🚀 场景三：批量操作 (&lt;foreach&gt;)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 为什么需要批量？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 实战代码
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ai" class="md-nav__link">
    <span class="md-ellipsis">
      
        🤖 AI 提效技巧
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ai-ai-pair-programming" class="md-nav__link">
    <span class="md-ellipsis">
      
        🤖 特别篇：AI 结对编程 (AI Pair Programming)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🤖 特别篇：AI 结对编程 (AI Pair Programming)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 场景：秒写“批量插入”语句
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ai" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. ⚠️ 关键检查点：AI 经常犯的错
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        📝 总结与速查表
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-pagehelper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    05. 插件生态：PageHelper 分页查询
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-transaction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    06. 事务管理：@Transactional 与 ACID
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    实验4：数据落地——从内存 Map 到 MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../chapter05/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    第五篇｜AI 集成与智能体基础
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    第五篇｜AI 集成与智能体基础
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter05/01-ai-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01. Java 也就是个“浏览器”：HTTP Client 调用 AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter05/02-prompt-java/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02. 提示词工程与Java模板
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter05/03-structured-output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03. 让 AI 说“机器话”：JSON Schema 与解析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter05/04-tool-calling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    04. 赋予 AI 双手：Tool Calling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter05/05-spring-ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    05. 简化开发：拥抱 Spring AI 框架
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter05/06-mcp-intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    06. 未来的标准：MCP简介
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter05/lab5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    实验5：智能客服Agent实战
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../chapter06/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    第六篇｜综合项目实战
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    第六篇｜综合项目实战
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter06/01-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    01. 需求分析与建模(Visual Modeling)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter06/02-implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    02. 核心业务开发(AI 辅助编码)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter06/03-agent-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    03. 智能体集成(Tool Calling 实战)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chapter06/lab6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    实验6 二手书交易智能体
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    📚 附录 进阶资源与内功修炼
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    📚 附录 进阶资源与内功修炼
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🛠️ A. 开发环境与工具链
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    🛠️ A. 开发环境与工具链
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/a01-account-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A01. 开发者账号与工具权益申请指南
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/a02-docker-deploy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A02. Docker 容器化部署实战
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/a03-opengauss-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A03. OpenGauss 数据库安装指南
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🤖 D. Spring AI 框架尝鲜
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    🤖 D. Spring AI 框架尝鲜
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/d01-spring-ai-quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    D01. 快速接入 OpenAI/国产大模型
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/d02-simple-rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    D02. 简单的 RAG 实现 (课程助教)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    🔭 E. 职业视野与资源库
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    🔭 E. 职业视野与资源库
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/e01-industry-report/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    E01. Java Web 行业全景报告
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../appendix/e02-opensource-projects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    E02. 精选开源项目库
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#if-where" class="md-nav__link">
    <span class="md-ellipsis">
      
        🚦 场景一：智能条件查询 (&lt;if&gt; 与 &lt;where&gt;)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🚦 场景一：智能条件查询 (&lt;if&gt; 与 &lt;where&gt;)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 业务痛点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mybatis" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. MyBatis 的解决方案
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-where" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. &lt;where&gt; 标签的魔法
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set" class="md-nav__link">
    <span class="md-ellipsis">
      
        🛠️ 场景二：智能更新 (&lt;set&gt;)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🛠️ 场景二：智能更新 (&lt;set&gt;)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 业务痛点
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 实战代码
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foreach" class="md-nav__link">
    <span class="md-ellipsis">
      
        🚀 场景三：批量操作 (&lt;foreach&gt;)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🚀 场景三：批量操作 (&lt;foreach&gt;)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 为什么需要批量？
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 实战代码
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ai" class="md-nav__link">
    <span class="md-ellipsis">
      
        🤖 AI 提效技巧
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ai-ai-pair-programming" class="md-nav__link">
    <span class="md-ellipsis">
      
        🤖 特别篇：AI 结对编程 (AI Pair Programming)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🤖 特别篇：AI 结对编程 (AI Pair Programming)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 场景：秒写“批量插入”语句
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ai" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. ⚠️ 关键检查点：AI 经常犯的错
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        📝 总结与速查表
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="04-mybatis-sql">04. MyBatis 的杀手锏：动态 SQL<a class="headerlink" href="#04-mybatis-sql" title="Permanent link">&para;</a></h1>
<div class="admonition quote">
<p class="admonition-title">告别“字符串拼接”的噩梦</p>
<p>在 JDBC 时代，如果你要实现一个“多条件搜索”功能（比如用户可能只填名字，也可能只填电话，或者两个都填），你需要在 Java 代码里写一堆 <code>if (name != null) { sql += " AND name = ..." }</code>。</p>
<p>一旦漏掉一个空格，程序就报错；一旦多了一个 <code>AND</code>，SQL 就语法错误。</p>
<p><strong>动态 SQL</strong> 是 MyBatis 最强大的特性之一。它让你在 XML 中像写代码一样写 SQL（支持 if, foreach 等逻辑），彻底终结了手动拼接 SQL 的“石器时代”。</p>
</div>
<hr />
<h2 id="if-where">🚦 场景一：智能条件查询 (<code>&lt;if&gt;</code> 与 <code>&lt;where&gt;</code>)<a class="headerlink" href="#if-where" title="Permanent link">&para;</a></h2>
<h3 id="1">1. 业务痛点<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>用户在搜索框里：</p>
<ul>
<li>有时只输入用户名。</li>
<li>有时只输入手机号。</li>
<li>有时什么都不输（想看全部）。</li>
</ul>
<p>如果用传统的 SQL 写死 <code>WHERE username = ? AND phone = ?</code>，当用户没填手机号时，查询条件变成了 <code>phone = null</code>，导致查不到数据。</p>
<h3 id="2-mybatis">2. MyBatis 的解决方案<a class="headerlink" href="#2-mybatis" title="Permanent link">&para;</a></h3>
<p>我们需要 SQL 能根据参数<strong>“动态变形”</strong>。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">UserMapper.xml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="nt">&lt;select</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;searchUser&quot;</span><span class="w"> </span><span class="na">resultType=</span><span class="s">&quot;com.example.entity.User&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span>t_user
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="nt">&lt;where&gt;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">        </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;username != null and username != &#39;&#39;&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">            </span>AND<span class="w"> </span>username<span class="w"> </span>LIKE<span class="w"> </span>concat(&#39;%&#39;,<span class="w"> </span>#{username},<span class="w"> </span>&#39;%&#39;)
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">        </span><span class="nt">&lt;/if&gt;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">        </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;phone != null and phone != &#39;&#39;&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">            </span>AND<span class="w"> </span>phone<span class="w"> </span>=<span class="w"> </span>#{phone}
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">        </span><span class="nt">&lt;/if&gt;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="nt">&lt;/where&gt;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="nt">&lt;/select&gt;</span>
</code></pre></div></td></tr></table></div>
<h3 id="3-where">3. <code>&lt;where&gt;</code> 标签的魔法<a class="headerlink" href="#3-where" title="Permanent link">&para;</a></h3>
<p>你可能会问：<em>“如果第一个条件不满足，直接拼接第二个条件，SQL 会不会变成 <code>SELECT * FROM t_user WHERE AND phone = ...</code>（多了一个 AND）？”</em></p>
<p>别担心，<code>&lt;where&gt;</code> 标签非常智能：</p>
<ul>
<li><strong>自动剔除</strong>：如果标签内部的内容以 <code>AND</code> 或 <code>OR</code> 开头，它会自动把第一个 <code>AND</code> 删掉。</li>
<li><strong>自动隐藏</strong>：如果标签内部没有任何条件成立（所有 <code>if</code> 都为假），它连 <code>WHERE</code> 关键字都不会生成。</li>
</ul>
<pre class="mermaid"><code>graph TD
    Input[输入参数: username=null, phone=10086] --&gt; Check1{&lt;if test=username&gt;}
    Check1 -- False (跳过) --&gt; Check2{&lt;if test=phone&gt;}
    Check2 -- True --&gt; Append[拼接: AND phone = 10086]
    Append --&gt; WhereTag[&lt;where&gt; 标签处理]
    WhereTag --&gt;|发现开头有多余的 AND| Strip[自动剔除开头的 AND]
    Strip --&gt; Result[最终 SQL: &lt;br/&gt;SELECT * FROM t_user WHERE phone = 10086]

    style WhereTag fill:#fff9c4,stroke:#fbc02d
    style Result fill:#c8e6c9,stroke:#2e7d32
</code></pre>
<hr />
<h2 id="set">🛠️ 场景二：智能更新 (<code>&lt;set&gt;</code>)<a class="headerlink" href="#set" title="Permanent link">&para;</a></h2>
<h3 id="1_1">1. 业务痛点<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h3>
<p>在“修改个人信息”页面，用户可能只改了头像，没改密码。
如果我们执行 <code>UPDATE t_user SET password = #{password}, avatar = #{avatar} ...</code>，那些没改的字段（为 null）就会把数据库里原本的数据覆盖为空。</p>
<h3 id="2">2. 实战代码<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p><code>&lt;set&gt;</code> 标签专门用于 update 语句，它会自动处理行尾多余的逗号。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">UserMapper.xml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nt">&lt;update</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;updateUser&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span>UPDATE<span class="w"> </span>t_user
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="nt">&lt;set&gt;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">        </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;username != null&quot;</span><span class="nt">&gt;</span>username<span class="w"> </span>=<span class="w"> </span>#{username},<span class="nt">&lt;/if&gt;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">        </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;password != null&quot;</span><span class="nt">&gt;</span>password<span class="w"> </span>=<span class="w"> </span>#{password},<span class="nt">&lt;/if&gt;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">        </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;phone != null&quot;</span><span class="nt">&gt;</span>phone<span class="w"> </span>=<span class="w"> </span>#{phone},<span class="nt">&lt;/if&gt;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">        </span><span class="nt">&lt;if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;avatar != null&quot;</span><span class="nt">&gt;</span>avatar<span class="w"> </span>=<span class="w"> </span>#{avatar},<span class="nt">&lt;/if&gt;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="nt">&lt;/set&gt;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span>WHERE<span class="w"> </span>id<span class="w"> </span>=<span class="w"> </span>#{id}
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="nt">&lt;/update&gt;</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="foreach">🚀 场景三：批量操作 (<code>&lt;foreach&gt;</code>)<a class="headerlink" href="#foreach" title="Permanent link">&para;</a></h2>
<h3 id="1_2">1. 为什么需要批量？<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h3>
<p>假设你要删除 100 个用户。</p>
<ul>
<li><strong>低效做法</strong>：在 Java 里写个 <code>for</code> 循环，调用 100 次数据库。这会建立 100 次连接，性能极差。</li>
<li><strong>高效做法</strong>：生成一条 SQL <code>DELETE FROM t_user WHERE id IN (1, 2, 3, ...)</code>。一次连接，搞定所有。</li>
</ul>
<h3 id="2_1">2. 实战代码<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<p><code>&lt;foreach&gt;</code> 标签可以遍历 Java 传递过来的 List 或 Array 集合。</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">UserMapper.xml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;deleteBatch&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span>DELETE<span class="w"> </span>FROM<span class="w"> </span>t_user<span class="w"> </span>WHERE<span class="w"> </span>id<span class="w"> </span>IN
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="nt">&lt;foreach</span><span class="w"> </span><span class="na">collection=</span><span class="s">&quot;ids&quot;</span><span class="w"> </span><span class="na">item=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">open=</span><span class="s">&quot;(&quot;</span><span class="w"> </span><span class="na">separator=</span><span class="s">&quot;,&quot;</span><span class="w"> </span><span class="na">close=</span><span class="s">&quot;)&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">        </span>#{id}
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="nt">&lt;/foreach&gt;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="nt">&lt;/delete&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>生成的 SQL 效果</strong>：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t_user</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="mi">102</span><span class="p">,</span><span class="w"> </span><span class="mi">103</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="ai">🤖 AI 提效技巧<a class="headerlink" href="#ai" title="Permanent link">&para;</a></h2>
<p>动态 SQL 的语法（特别是 <code>&lt;foreach&gt;</code> 的属性）很容易记混。这时候，AI 又是你的好帮手。</p>
<div class="admonition tip">
<p class="admonition-title">Prompt (提示词) 范例</p>
<p><strong>你</strong>：DeepSeek，请帮我写一个 MyBatis 的动态 update 语句。<br />
<strong>场景</strong>：表名 <code>t_product</code>，主键 <code>id</code>。<br />
<strong>要求</strong>：<br />
1. 使用 <code>&lt;set&gt;</code> 标签。<br />
2. 只有当字段 <code>price</code>, <code>stock</code>, <code>name</code> 不为空时才更新它们。<br />
3. 请直接给出 XML 代码。  </p>
</div>
<hr />
<h2 id="ai-ai-pair-programming">🤖 特别篇：AI 结对编程 (AI Pair Programming)<a class="headerlink" href="#ai-ai-pair-programming" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">🧠 你的外脑：把记忆负担交给 AI</p>
<p>动态 SQL 的标签语法（尤其是 <code>&lt;foreach&gt;</code> 的 <code>collection</code>, <code>open</code>, <code>separator</code> 属性）非常琐碎，像以前那样死记硬背已经过时了。</p>
<p><strong>现在的开发模式是：你负责提供逻辑，AI 负责提供语法。</strong></p>
</div>
<h3 id="1_3">1. 场景：秒写“批量插入”语句<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h3>
<p>手写一个支持 List 集合的批量插入语句（Batch Insert）非常痛苦，极易写错。</p>
<p><strong>👨‍💻 工程师职责：定义接口</strong>
首先，由你来定义清晰的 Java 接口规范：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1">// UserMapper.java</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="c1">// 这是一个难点，参数是一个 List</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">insertBatch</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;users&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">userList</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p><strong>🤖 AI 职责：生成实现</strong>
接着，将繁琐的 XML 语法工作交给 AI。试着发送以下 Prompt：</p>
<div class="admonition example">
<p class="admonition-title">🔮 复制此 Prompt 给 AI</p>
<p>"我正在使用 MyBatis。
请帮我生成一个 <strong>批量插入 (Batch Insert)</strong> 的 XML 语句。</p>
<ul>
<li><strong>表名</strong>: <code>t_user</code></li>
<li><strong>字段</strong>: <code>username</code>, <code>password</code>, <code>phone</code></li>
<li><strong>接口参数名</strong>: <code>users</code> (这是一个 List<User>)</li>
<li><strong>要求</strong>: 使用 <code>&lt;foreach&gt;</code> 标签，注意 separator 的处理。请直接给出 XML 代码。"</li>
</ul>
</div>
<h3 id="2-ai">2. ⚠️ 关键检查点：AI 经常犯的错<a class="headerlink" href="#2-ai" title="Permanent link">&para;</a></h3>
<p>AI 生成的代码通常长这样：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nt">&lt;insert</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;insertBatch&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span>INSERT<span class="w"> </span>INTO<span class="w"> </span>t_user<span class="w"> </span>(username,<span class="w"> </span>password,<span class="w"> </span>phone)<span class="w"> </span>VALUES
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="nt">&lt;foreach</span><span class="w"> </span><span class="na">collection=</span><span class="s">&quot;users&quot;</span><span class="w"> </span><span class="na">item=</span><span class="s">&quot;u&quot;</span><span class="w"> </span><span class="na">separator=</span><span class="s">&quot;,&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">        </span>(#{u.username},<span class="w"> </span>#{u.password},<span class="w"> </span>#{u.phone})
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="nt">&lt;/foreach&gt;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="nt">&lt;/insert&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>作为技术经理，你需要检查 AI 的一个经典 Bug：</strong></p>
<ul>
<li><strong>检查 collection 属性</strong>：</li>
<li>如果你在接口里用了 <code>@Param("users")</code>，那么 XML 里的 <code>collection</code> <strong>必须</strong> 是 <code>"users"</code>。</li>
<li>如果你没用 <code>@Param</code>，MyBatis 默认的名字通常是 <code>"list"</code> 或 <code>"arg0"</code>。</li>
<li><strong>AI 经常会猜错这个名字！</strong> 如果报错 <code>Parameter 'users' not found</code>，请第一时间检查这里。</li>
</ul>
<hr />
<h2 id="_1">📝 总结与速查表<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>动态 SQL 是 MyBatis 区别于其他 ORM 框架（如 JPA）的核心竞争力，它赋予了开发者对 SQL 的<strong>绝对控制权</strong>。</p>
<table>
<thead>
<tr>
<th>标签</th>
<th>作用</th>
<th>这里的“智能”体现在哪？</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;if&gt;</code></td>
<td>条件判断</td>
<td>类似于 Java 的 if，通过 <code>test</code> 属性判断真假。</td>
</tr>
<tr>
<td><code>&lt;where&gt;</code></td>
<td>组装条件</td>
<td>自动处理 SQL 开头多余的 <code>AND</code> / <code>OR</code>；如果没条件则不生成 WHERE。</td>
</tr>
<tr>
<td><code>&lt;set&gt;</code></td>
<td>组装更新</td>
<td>自动处理 SQL 行尾多余的 <code>逗号 (,)</code>。</td>
</tr>
<tr>
<td><code>&lt;foreach&gt;</code></td>
<td>循环遍历</td>
<td>专治 <code>IN (...)</code> 查询和批量插入，性能极其强悍。</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">避坑指南</p>
<p>在 <code>&lt;if test="..."&gt;</code> 中，判断字符串非空时，一定要同时判断 <code>null</code> 和 <code>空字符串</code>。</p>
<ul>
<li>❌ <strong>错误</strong>：<code>test="username != null"</code> (如果传空串 <code>""</code>，会生成 <code>name = ''</code>，可能查不到数据)</li>
<li>✅ <strong>正确</strong>：<code>test="username != null and username != ''"</code></li>
</ul>
</div>
<p><a class="md-button md-button--primary" href="https://www.google.com/search?q=05-pagehelper.md">下一节：插件生态 - PageHelper 分页查询</a></p>







  
  





<script src="https://giscus.app/client.js"
        data-repo="dedeguo/javaweb-course-docs"
        data-repo-id="R_kgDOQj_o1A"
        data-category="Comments"
        data-category-id="DIC_kwDOQj_o1M4CzvTT"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 武汉工商学院 计算机与自动化学院 陈德
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["search.highlight", "search.suggest", "content.code.copy", "navigation.indexes", "navigation.sections", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>